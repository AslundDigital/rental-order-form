
<!DOCTYPE html>
<html>
<head>
  <title>Equipment Rental Order</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: auto; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border-bottom: 1px solid #ddd; padding: 8px; }
    input[type="number"] { width: 60px; }
    .section-header { font-weight: bold; background-color: #f0f0f0; padding: 10px 0; }
    textarea { width: 100%; min-height: 80px; }
  </style>
</head>
<body>

<h2>Step 1: Customer Info</h2>
<form id="step1-form">
  <table>
    <tr><td><label>Email:</label></td><td><input type="email" name="email" required></td></tr>
    <tr><td><label>First Name:</label></td><td><input type="text" name="firstName" required pattern="[A-Za-z]+" /></td></tr>
    <tr><td><label>Last Name:</label></td><td><input type="text" name="lastName" required pattern="[A-Za-z]+" /></td></tr>
    <tr><td><label>Phone:</label></td><td><input type="tel" name="phone" required pattern="[0-9]+" /></td></tr>
    <tr><td><label>Rental Date:</label></td><td><input type="date" name="rentalDate" required>
      <select name="rentalTime" required>
        <option value="">Time</option>
        <option>08:00</option><option>08:30</option><option>09:00</option><option>09:30</option>
        <option>10:00</option><option>10:30</option><option>11:00</option><option>11:30</option>
        <option>12:00</option><option>12:30</option><option>13:00</option><option>13:30</option>
        <option>14:00</option><option>14:30</option><option>15:00</option><option>15:30</option>
        <option>16:00</option><option>16:30</option><option>17:00</option>
      </select></td></tr>
    <tr><td><label>Return Date:</label></td><td><input type="date" name="returnDate" required>
      <select name="returnTime" required>
        <option value="">Time</option>
        <option>08:00</option><option>08:30</option><option>09:00</option><option>09:30</option>
        <option>10:00</option><option>10:30</option><option>11:00</option><option>11:30</option>
        <option>12:00</option><option>12:30</option><option>13:00</option><option>13:30</option>
        <option>14:00</option><option>14:30</option><option>15:00</option><option>15:30</option>
        <option>16:00</option><option>16:30</option><option>17:00</option>
      </select></td></tr>
  </table>
  <button type="submit">Continue</button>
</form>

<div id="step2" class="hidden">
  <h2>Step 2: Select Equipment</h2>
  <form id="step2-form">
    <input type="hidden" id="emailHidden" name="email" />
    <table id="item-table"></table>
    <button type="submit">Continue</button>
  </form>
</div>

<div id="step3" class="hidden">
  <h2>Step 3: Additional Requests</h2>
  <form id="step3-form">
    <p>Please include any additional equipment or staffing requests that we can obtain for you:</p>
    <textarea name="message" placeholder="Type your request here..."></textarea><br><br>
    <input type="hidden" id="emailHidden2" name="email" />
    <button type="submit">Submit</button>
  </form>
</div>

<script>
const webAppURL = 'https://script.google.com/macros/s/AKfycbwfd4OkZrMObAc0NwGXpckka--GgSz2olgpXFZwxOeQyBAkS5DJktevKHhNXv01yT1c/exec';

document.getElementById("step1-form").addEventListener("submit", function(e) {
  e.preventDefault();
  const email = this.email.value;
  document.getElementById("emailHidden").value = email;
  document.getElementById("emailHidden2").value = email;
  document.getElementById("step1-form").classList.add("hidden");
  document.getElementById("step2").classList.remove("hidden");
  loadItems();
});

function loadItems() {
  fetch(webAppURL)
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById("item-table");
      table.innerHTML = "";
      data.forEach(item => {
        const row = document.createElement("tr");
        if (!item.price) {
          const header = document.createElement("td");
          header.colSpan = 2;
          header.className = "section-header";
          header.textContent = item.name;
          row.appendChild(header);
        } else {
          const td1 = document.createElement("td");
          td1.textContent = item.name + " ($" + item.price + "/day)";
          const td2 = document.createElement("td");
          td2.innerHTML = '<input type="number" name="qty-' + item.name + '" min="0" data-price="' + item.price + '">';
          row.appendChild(td1);
          row.appendChild(td2);
        }
        table.appendChild(row);
      });
    });
}

document.getElementById("step2-form").addEventListener("submit", function(e) {
  e.preventDefault();
  const form = new FormData(this);
  const items = [];
  for (const [key, val] of form.entries()) {
    if (key.startsWith("qty-") && val && parseInt(val) > 0) {
      const name = key.replace("qty-", "");
      const input = this.querySelector("[name='" + key + "']");
      const price = parseFloat(input.dataset.price || 0);
      items.push({ name, quantity: val, price });
    }
  }
  fetch(webAppURL, {
    method: "POST",
    body: new URLSearchParams({
      type: "step2",
      email: document.getElementById("emailHidden").value,
      items: JSON.stringify(items)
    })
  }).then(() => {
    document.getElementById("step2").classList.add("hidden");
    document.getElementById("step3").classList.remove("hidden");
  });
});

document.getElementById("step3-form").addEventListener("submit", function(e) {
  e.preventDefault();
  const form = new FormData(this);
  fetch(webAppURL, {
    method: "POST",
    body: new URLSearchParams({
      type: "step3",
      email: form.get("email"),
      message: form.get("message")
    })
  }).then(() => {
    alert("Your order has been submitted!");
    location.reload();
  });
});
</script>

</body>
</html>
