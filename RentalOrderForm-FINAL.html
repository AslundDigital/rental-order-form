
<!-- === Rental Order Form (Step 1 & 2) === -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Rental Order Form</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 400px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .hidden { display: none; }
    .center { text-align: center; }
  </style>
</head>
<body>

<div id="step1">
  <h2>Customer Information</h2>
  <form id="form1">
    <input type="text" name="firstName" placeholder="First Name" required pattern="[A-Za-z]+" />
    <input type="text" name="lastName" placeholder="Last Name" required pattern="[A-Za-z]+" />
    <input type="email" name="email" placeholder="Email" required />
    <input type="tel" name="phone" placeholder="Phone (e.g., 1234567890)" required pattern="\d{10}" />
    <input type="datetime-local" name="rentalDate" required />
    <input type="datetime-local" name="returnDate" required />
    <button type="submit">Next</button>
  </form>
</div>

<div id="step2" class="hidden">
  <h2>Item Selection</h2>
  <form id="form2">
    <table id="itemsTable">
      <thead>
        <tr><th>Item</th><th>Rental/Day</th><th>Quantity</th><th>Line Total</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="center">
      <button type="submit">Submit Order</button>
    </div>
  </form>
</div>

<div id="confirmation" class="hidden center">
  <h3>Thank you! Your order has been received.</h3>
</div>

<script>
let customerEmail = "";

document.getElementById("form1").addEventListener("submit", function(e) {
  e.preventDefault();
  const form = new FormData(this);
  fetch('https://script.google.com/macros/s/AKfycbwfd4OkZrMObAc0NwGXpckka--GgSz2olgpXFZwxOeQyBAkS5DJktevKHhNXv01yT1c/exec', {
    method: 'POST',
    body: new URLSearchParams({
      type: 'step1',
      firstName: form.get("firstName"),
      lastName: form.get("lastName"),
      email: form.get("email"),
      phone: form.get("phone"),
      rentalDate: form.get("rentalDate"),
      returnDate: form.get("returnDate")
    })
  })
  .then(res => res.text())
  .then(res => {
    if (res === "STEP1_OK") {
      customerEmail = form.get("email");
      document.getElementById("step1").classList.add("hidden");
      document.getElementById("step2").classList.remove("hidden");
      loadInventory();
    }
  });
});

function loadInventory() {
  fetch('https://script.google.com/macros/s/AKfycbwfd4OkZrMObAc0NwGXpckka--GgSz2olgpXFZwxOeQyBAkS5DJktevKHhNXv01yT1c/exec')
    .then(res => res.json())
    .then(items => {
      const tbody = document.querySelector("#itemsTable tbody");
      items.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.name}</td>
          <td>$${item.price}</td>
          <td><input type="number" min="0" data-price="${item.price}" data-name="${item.name}" /></td>
          <td class="line-total">$0</td>
        `;
        tbody.appendChild(row);
      });

      tbody.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", function() {
          const qty = parseInt(this.value) || 0;
          const price = parseFloat(this.dataset.price);
          const total = qty * price;
          this.closest("tr").querySelector(".line-total").innerText = `$${total.toFixed(2)}`;
        });
      });
    });
}

document.getElementById("form2").addEventListener("submit", function(e) {
  e.preventDefault();
  const items = [];
  document.querySelectorAll("#itemsTable input").forEach(input => {
    const qty = parseInt(input.value);
    if (qty > 0) {
      items.push({
        name: input.dataset.name,
        quantity: qty,
        price: parseFloat(input.dataset.price)
      });
    }
  });

  if (items.length === 0) return alert("Please enter at least one quantity.");

  fetch('https://script.google.com/macros/s/AKfycbwfd4OkZrMObAc0NwGXpckka--GgSz2olgpXFZwxOeQyBAkS5DJktevKHhNXv01yT1c/exec', {
    method: 'POST',
    body: new URLSearchParams({
      type: 'step2',
      email: customerEmail,
      items: JSON.stringify(items)
    })
  })
  .then(res => res.text())
  .then(res => {
    if (res === "STEP2_OK") {
      document.getElementById("step2").classList.add("hidden");
      document.getElementById("confirmation").classList.remove("hidden");
    }
  });
});
</script>
</body>
</html>
